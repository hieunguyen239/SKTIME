var _history=window.history&&window.history.pushState,firstChangeUrl=!0;_history&&$(window).on("popstate",function(t){var e=t.originalEvent.state;e&&e.display&&e.html&&($(e.display).html(e.html),$("title").html(e.title))}),Date.prototype.today=function(){return(this.getDate()<10?"0":"")+this.getDate()+"/"+(this.getMonth()+1<10?"0":"")+(this.getMonth()+1)+"/"+this.getFullYear()},Date.prototype.timeNow=function(){return(this.getHours()<10?"0":"")+this.getHours()+":"+(this.getMinutes()<10?"0":"")+this.getMinutes()+":"+(this.getSeconds()<10?"0":"")+this.getSeconds()};function Loading(t){var e=!0;t&&0!=t.length||(e=!1,t=$("body"));var a=$('<div class="loading"></div>');e&&a.addClass("absolute"),a.append('<span class="centerer"></span><div class="centered uil-ring-css"><div></div></div>'),$(t).append(a)}function Loaded(t){t&&0!=t.length||(t=$("body")),$(t).find("> .loading").remove()}function AjaxRequest(t){$.ajax({url:t.url,dataType:"json",type:t.type?t.type:"GET",data:t.data,async:!0,contentType:!1,processData:!!t.processData||t.processData,cache:!1,xhr:function(){var e=new window.XMLHttpRequest;return t.uploadProgress&&e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var a=e.loaded/e.total;t.uploadProgress(a)}},!1),t.downloadProgress&&e.addEventListener("progress",function(e){if(e.lengthComputable){var a=e.loaded/e.total;t.downloadProgress(a)}},!1),e},beforeSend:t.beforeSend?t.beforeSend:function(){Loading()},complete:t.complete?t.complete:function(){Loaded()},success:t.success,error:t.error})}function ChangeUrl(t,e,a){_history&&(firstChangeUrl&&(window.history.pushState({display:"#main-content",html:$("#main-content").html(),title:$("title").html()},$("title").html(),window.location.pathname),firstChangeUrl=!1),$("title").html(t),window.history.pushState(a,t,e))}function ProcessForms(t){$(t).find(".date").each(function(t,e){var a=$(e).attr("format");void 0!=a&&""!=a||(a=_DateTimeFormatString),$(e).datetimepicker({format:a})}),$(t).find("form").each(function(t,e){var a=$(e).attr("action"),n=$(e).attr("method"),r=$(e).attr("for"),o=$(e).attr("fail"),i=$(e).attr("url"),s="true"==$(e).attr("keep-pop-up"),l=$(e).serialize();r&&(r="#"+r),o&&(o="#"+o),$(e).find('input[type="submit"]').on("click",function(){var t=$(this).attr("url"),c=$("title").html();try{if("get"==n.toLowerCase()){if(""!=l)return a+=l}else l=new FormData,$.each($(e).serializeArray(),function(t,e){l.append(e.name,e.value)});return AjaxRequest({url:a,data:l,type:n,processData:"post"!=n.toLowerCase(),success:function(a){a.result?(i&&(window.location=i),a.redirect&&(window.location=a.redirect)):a.message&&$(e).find("#form-message").html(a.message),r&&a.html&&(0==a.result&&o&&(r=o),$(r).html(a.html),ProcessLinks(r),ProcessForms(r),"#pop-up-content"==r?($("#pop-up").addClass("active"),$("body").addClass("locked")):s||($("#pop-up").removeClass("active"),$("body").removeClass("locked"))),a.result&&t&&ChangeUrl(c,t,{display:"#main-content",html:a.html,title:c})},error:function(t){console.log(t)}}),!1}catch(t){return!1}}),$(e).find('input[type="file"][url]').on("change",function(){for(var t=this.files,e=$(this).attr("name"),a=$(this).attr("folder"),n=$(this).attr("url"),r=$(this).attr("for"),o=0;o<t.length;o++){var i=new FormData;i.append("folder",a),i.append(t[o].name,t[o]),AjaxRequest({url:n,type:"post",data:i,processData:!1,success:function(t){$('img[for="'+e+'"]').attr("src",t.img),$("input[name="+r+"]").val(t.file)},uploadProgress:function(t){}})}}),ProcessSelects(e)})}function ProcessSelects(t){$(t).find("select[data]").each(function(e,a){var n=$(a).attr("data");"1"!=$(a).attr("load")&&($(a).attr("load","1"),AjaxRequest({url:n,type:"post",processData:!1,success:function(e){e.id&&e.name&&$(t).find('select[data="'+n+'"]').each(function(t,a){var n=$(a).attr("value");e.id.forEach(function(t,r){$(a).append('<option value="'+t+'" '+(t==n?"selected":"")+">"+e.name[r]+"</option>")})}),InitTagList({el:a,list:e})}}))})}function ProcessLinks(t){$(t).find("a[for]").on("click",function(){try{var t=$(this).attr("href"),e="#"+$(this).attr("for"),a=$(this).attr("ptitle"),n="true"==$(this).attr("keeppopup"),r="false"==$(this).attr("changeurl");return a||(a=""),AjaxRequest({url:t,type:"GET",success:function(o){r||ChangeUrl(a,t,{display:"#main-content",html:o.html,title:a}),o.remove?$(e).remove():($(e).html(o.html),n||("#pop-up-content"==e?($("#pop-up").addClass("active"),$("body").addClass("locked")):($("#pop-up").removeClass("active"),$("body").removeClass("locked"))),ProcessLinks(e),ProcessForms(e))},error:function(e){window.location=t}}),!1}catch(t){return!0}}),$(".tabs").each(function(t,e){$(e).find("span[for]").on("click",function(){var t=$(this).attr("for");$(e).find("span[for]").each(function(e,a){var n=$(a).attr("for");t==n?($(a).addClass("active"),$("#"+n).removeClass("hidden")):($(a).removeClass("active"),$("#"+n).addClass("hidden"))})})})}function NewTag(t){var e=t.list,a=t.removeUrl,n=t.display,r=$('<span class="tag" value="'+t.value+'"><span id="remove">x</span><span id="name">'+t.name+"</span></span>");return $("#"+n).append(r),InitTagItem({el:r,list:e,removeUrl:a}),$(e).find('option[value="'+t.value+'"]').remove(),$(e).val(""),r}function InitTagList(t){var e=t.el,a=$(e).attr("tag-add"),n=$(e).attr("tag-remove"),r=$(e).attr("for");a&&n&&r&&(t.list&&t.list.tagged&&t.list.tagged.forEach(function(a,o){a&&NewTag({list:e,removeUrl:n,display:r,name:t.list.name[o],value:t.list.id[o]})}),$(e).on("change",function(){var t=$(this),e=t.val();if(""!=e){var o=t.find('option[value="'+e+'"]').html();_messageActive=!0,AjaxRequest({url:a.replace("__ID",e),success:function(a){a.result&&NewTag({list:t,removeUrl:n,display:r,name:o,value:e})}})}}))}function InitTagItem(t){$(t.el).find("#remove").on("click",function(){var e=$(this).parent(),a=e.attr("value"),n=e.find("#name").html();AjaxRequest({url:t.removeUrl.replace("__ID",a),success:function(r){r.result&&($(t.list).append('<option value="'+a+'">'+n+"</option>"),e.remove())}})})}function GetCurrencyString(t){var e=(t=parseInt(t)).toString(),a="";e.startsWith("-")&&(e=e.substring(1,e.length),a="-");var n=e.length%3,r=parseInt(e.length/3);if(0==r)return a+e;var o=e.substring(0,n)+",";o=","==o?"":o;for(var i=0;i<r;i++)o+=e.substring(3*i+n,3*(i+1)+n)+(i==r-1?"":",");return a+o}function Print(t){var e=new Date;$("#"+t+" #date").html(e.today()+" "+e.timeNow());var a='<div id="print">'+document.getElementById(t).innerHTML+"</div>";$("#page-body").addClass("hidden"),$("body").append(a),window.print(),$("#print").remove(),$("#page-body").removeClass("hidden")}String.prototype.replaceAll=function(t,e){return this.replace(new RegExp(t,"g"),e)};function NumberInput(t){$(t).find(".input-number").each(function(t,e){var a=$(e).find('input[type="number"]'),n=$('<span contenteditable="true" for="'+a.attr("id")+'">'+GetCurrencyString(a.val())+"</span>");$(e).append(n),$(e).find('[contenteditable="true"]').on("keyup",function(){var t=$(this).html(),e=parseInt(t.replaceAll(",",""));isNaN(e)||(a.val(e),a.trigger("change")),$(this).html(GetCurrencyString(a.val()));var n=document.createRange();n.setStart(this,1);var r=window.getSelection();n.collapse(!0),r.removeAllRanges(),r.addRange(n)})})}